<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>RAG Demo - Ask a Question</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 2em; background: #f9f9f9; }
        #container { background: #fff; padding: 2em; border-radius: 8px; max-width: 600px; margin: auto; box-shadow: 0 2px 8px #ccc; }
        label { font-weight: bold; }
        textarea { width: 100%; height: 60px; font-size: 1em; }
        button { font-size: 1em; padding: 0.5em 1.5em; margin-top: 1em; }
        #answer, #retrieved { margin-top: 2em; white-space: pre-line; }
        .retrieved-block { background: #f0f0f0; border-left: 4px solid #3b82f6; padding: 1em; margin-bottom: 1em; }
    </style>
</head>
<body>
<div id="container">
    <h2>RAG Demo: Ask a Question</h2>
    <form id="qa-form">
        <label for="question">Your question:</label><br>
        <textarea id="question" required></textarea><br>
        <button type="submit">Ask</button>
    </form>

    <div id="loading" style="display:none;">Processing...</div>
    <div id="answer"></div>
    <div id="retrieved"></div>
</div>

<script>
document.getElementById("qa-form").addEventListener("submit", async function(e) {
    e.preventDefault();
    document.getElementById("answer").innerHTML = "";
    document.getElementById("retrieved").innerHTML = "";
    document.getElementById("loading").style.display = "block";

    const question = document.getElementById("question").value.trim();
    if (!question) return;

    try {
        const response = await fetch("/rag", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({ question })
        });

        const data = await response.json();
        document.getElementById("loading").style.display = "none";

        if (data.error) {
            document.getElementById("answer").innerHTML = `<span style="color:red;">Error: ${data.error}</span>`;
            return;
        }

        document.getElementById("answer").innerHTML = `<b>Answer:</b><br>${data.answer}`;
        if (data.retrieved && data.retrieved.length > 0) {
            let retrievedHTML = '<b>Retrieved Passages:</b><br>';
            for (const chunk of data.retrieved) {
                retrievedHTML += `<div class="retrieved-block">${chunk}</div>`;
            }
            document.getElementById("retrieved").innerHTML = retrievedHTML;
        }

    } catch (err) {
        document.getElementById("loading").style.display = "none";
        document.getElementById("answer").innerHTML = `<span style="color:red;">Error: ${err.message}</span>`;
    }
});
</script>
</body>
</html>